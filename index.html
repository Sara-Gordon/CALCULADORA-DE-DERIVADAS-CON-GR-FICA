<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Derivada por Primer Principio</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff0f5;
      padding: 30px;
      color: #333;
    }
    h1 {
      color: #d63384;
      text-align: center;
    }
    input {
      padding: 10px;
      width: 300px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    button {
      background-color: #ff69b4;
      border: none;
      padding: 10px 20px;
      color: white;
      border-radius: 10px;
      cursor: pointer;
    }
    .resultado, #grafico {
      margin-top: 20px;
      background-color: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .paso {
      margin-bottom: 15px;
      color: #222;
    }
    .formula {
      font-weight: bold;
      font-size: 1.2em;
      color: #d63384;
    }
  </style>
</head>
<body>
  <h1>Derivada por Primer Principio</h1>
  <input type="text" id="funcion" placeholder="Escribe una función, ej: x^2 o sin(x)" />
  <button onclick="calcularDerivada()">Calcular derivada</button>
  <div class="resultado" id="resultado"></div>
  <div id="grafico"></div>

  <script>
    function calcularDerivada() {
      const funcionStr = document.getElementById('funcion').value;
      const x = math.parse('x');
      let f;
      try {
        f = math.parse(funcionStr);
        const fx = f.compile();
        const h = 0.00001;
        const x0 = 2;

        // f(x+h) y f(x)
        const f_x0_h = fx.evaluate({ x: x0 + h });
        const f_x0 = fx.evaluate({ x: x0 });

        const numerador = f_x0_h - f_x0;
        const derivada = numerador / h;

        const pasos = `
          <div class="paso"><strong>PASO 1:</strong> Se desea encontrar la derivada de la función f(x) = ${funcionStr}</div>
          <div class="paso"><strong>PASO 2:</strong> Aplicamos la fórmula por primer principio:</div>
          <div class="formula">f'(x) = \(\frac{f(x+h) - f(x)}{h}\)</div>
          <div class="paso"><strong>PASO 3:</strong> Reemplazamos x = 2 (valor de prueba)</div>
          <div class="paso"><strong>PASO 4:</strong> f(2 + h) = ${f_x0_h.toFixed(5)}</div>
          <div class="paso"><strong>PASO 5:</strong> f(2) = ${f_x0.toFixed(5)}</div>
          <div class="paso"><strong>PASO 6:</strong> Reemplazamos en la fórmula:</div>
          <div class="formula">f'(2) = \(\frac{${f_x0_h.toFixed(5)} - ${f_x0.toFixed(5)}}{${h}}\)</div>
          <div class="paso"><strong>PASO 7:</strong> f'(2) ≈ ${numerador.toFixed(5)} / ${h}</div>
          <div class="paso"><strong>PASO 8:</strong> Resultado final: f'(2) ≈ <strong>${derivada.toFixed(5)}</strong></div>
        `;

        document.getElementById('resultado').innerHTML = pasos;

        // Gráfica
        const xs = Array.from({length: 100}, (_, i) => -5 + i * 0.1);
        const ys = xs.map(val => fx.evaluate({ x: val }));

        Plotly.newPlot('grafico', [{
          x: xs,
          y: ys,
          mode: 'lines',
          name: 'f(x)',
          line: { color: '#ff69b4' }
        }], {
          margin: { t: 30 },
          paper_bgcolor: '#fff0f5',
          plot_bgcolor: '#fff0f5',
          xaxis: { title: 'x', gridcolor: '#ccc' },
          yaxis: { title: 'f(x)', gridcolor: '#ccc' }
        });
      } catch (e) {
        document.getElementById('resultado').innerHTML = '<span style="color:red">⚠️ Error al procesar la función. Asegúrate de escribirla correctamente.</span>';
        document.getElementById('grafico').innerHTML = '';
      }
    }
  </script>
</body>
</html>

