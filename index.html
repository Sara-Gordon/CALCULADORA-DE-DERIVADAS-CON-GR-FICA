<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Derivada paso a paso</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background-color: #fff0f5;
      color: #333;
    }

    h1 {
      color: #d63384;
    }

    input, button {
      padding: 8px;
      font-size: 16px;
      margin-top: 10px;
    }

    .steps {
      margin-top: 20px;
      background-color: #ffe6f0;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .formula {
      background-color: white;
      padding: 10px;
      font-size: 18px;
      border-left: 4px solid #d63384;
      margin-bottom: 15px;
      font-family: Cambria, serif;
    }

    #plot {
      margin-top: 40px;
    }

  </style>
</head>
<body>

  <h1>üìò Derivada por el primer principio</h1>
  <label>Ingresa una funci√≥n (usa "x", por ejemplo: x^2, 1/x, sin(x), sqrt(x)):</label><br/>
  <input id="funcion" placeholder="Ejemplo: x^2" />
  <button onclick="calcular()">Calcular derivada</button>

  <div class="formula" id="formulafrac">
    $$f'(x) = \lim_{h \to 0} \dfrac{f(x+h) - f(x)}{h}$$
  </div>

  <div id="pasos" class="steps"></div>

  <div id="plot"></div>

  <script>
    function calcular() {
      const fInput = document.getElementById("funcion").value;
      const pasos = document.getElementById("pasos");
      pasos.innerHTML = "";
      let f;
      try {
        f = math.parse(fInput).compile();
      } catch (e) {
        pasos.innerHTML = "<b style='color:red'>‚ö†Ô∏è Error al procesar la funci√≥n. Aseg√∫rate de escribirla correctamente.</b>";
        return;
      }

      const x = math.symbolicUtils.symbol("x");
      const h = math.symbolicUtils.symbol("h");
      const fx = math.parse(fInput);
      const fxh = math.parse(fInput.replace(/x/g, "(x+h)"));

      const paso1 = `1Ô∏è‚É£ Definimos f(x) = ${fInput}`;
      const paso2 = `2Ô∏è‚É£ Calculamos f(x+h): f(x+h) = ${fxh.toString()}`;
      const paso3 = `3Ô∏è‚É£ Calculamos f(x+h) - f(x): ${fxh.toString()} - (${fx.toString()})`;
      const paso4 = `4Ô∏è‚É£ Lo colocamos sobre h: \\( \\frac{${fxh.toString()} - (${fx.toString()})}{h} \\)`;
      const paso5 = `5Ô∏è‚É£ Aplicamos el l√≠mite cuando h ‚Üí 0`;
      const paso6 = `6Ô∏è‚É£ Simplificamos la expresi√≥n (si es posible)`;
      const paso7 = `7Ô∏è‚É£ Reemplazamos h = 0 para obtener la derivada`;
      const paso8 = `8Ô∏è‚É£ Resultado: f'(x) = ${math.derivative(fInput, 'x').toString()}`;

      const steps = [paso1, paso2, paso3, paso4, paso5, paso6, paso7, paso8];
      steps.forEach(p => {
        const div = document.createElement("div");
        div.className = "formula";
        div.innerHTML = p.replace(/\\\(/g, "<span style='font-family:serif'>").replace(/\\\)/g, "</span>");
        pasos.appendChild(div);
      });

      // Graficar funci√≥n
      const fEvaluated = x => {
        try {
          return f.evaluate({ x });
        } catch (e) {
          return NaN;
        }
      };

      const xVals = [], yVals = [];
      for (let i = -10; i <= 10; i += 0.2) {
        xVals.push(i);
        yVals.push(fEvaluated(i));
      }

      Plotly.newPlot('plot', [{
        x: xVals,
        y: yVals,
        mode: 'lines',
        line: { color: 'deeppink' },
        name: `f(x) = ${fInput}`
      }], {
        title: 'Gr√°fica de la funci√≥n',
        paper_bgcolor: '#fff0f5',
        plot_bgcolor: '#fff0f5',
        xaxis: { gridcolor: '#ffb6c1', title: 'x' },
        yaxis: { gridcolor: '#ffb6c1', title: 'f(x)' }
      });
    }
  </script>

  <!-- MathJax para f√≥rmulas bonitas -->
  <script type="text/javascript" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</body>
</html>
