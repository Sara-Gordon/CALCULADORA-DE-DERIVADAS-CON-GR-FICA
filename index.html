<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Derivada - M√©todo del L√≠mite</title>

<!-- MathJax para f√≥rmulas -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Plotly para gr√°ficas -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- math.js para c√°lculos -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background-color: #fff0f5;
  color: #4a004d;
  padding: 20px;
  line-height: 1.6;
}
h1 {
  text-align: center;
  color: #d63384;
}
input, button {
  padding: 10px;
  margin: 8px;
  border: 2px solid #d63384;
  border-radius: 8px;
  font-size: 16px;
}
button {
  background-color: #f8b7d4;
  color: #4a004d;
  font-weight: bold;
  cursor: pointer;
}
.resultado {
  background: #ffe6f0;
  padding: 20px;
  border-radius: 10px;
  margin-top: 20px;
  box-shadow: 0 0 10px #e699c6;
  font-size: 17px;
}
#grafica {
  margin-top: 30px;
}
</style>
</head>
<body>

<h1>üå∏ Derivada usando el primer principio üå∏</h1>
<p><strong>Introduce la funci√≥n:</strong></p>
<input type="text" id="funcion" value="x^2 + 3*x + 2" size="35">
<p><strong>Introduce el punto x<sub>0</sub>:</strong></p>
<input type="number" id="x0" value="2" step="any">
<button onclick="calcular()">Calcular derivada</button>

<div class="resultado" id="explicacion"></div>
<div id="grafica" style="width:100%; height:500px;"></div>

<script>
function calcular() {
  const funcionStr = document.getElementById("funcion").value;
  const x0 = parseFloat(document.getElementById("x0").value);

  try {
    const parser = math.parser();
    parser.evaluate(`f(x) = ${funcionStr}`);

    let pasos = "";
    const f_xh_str = funcionStr.replace(/x/g, "(x+h)");
    const exprOriginal = math.parse(funcionStr);
    const exprXh = math.parse(f_xh_str);
    const resta = math.simplify(`(${f_xh_str}) - (${funcionStr})`).toString();
    const fraccion = math.simplify(`(${resta}) / h`).toString();
    const derivada = math.simplify(fraccion.replace(/h/g, "0")).toString();

    pasos += `<b>1Ô∏è‚É£ Definici√≥n de la derivada:</b><br>\\[ f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h} \\]<br><br>`;
    pasos += `<b>2Ô∏è‚É£ Funci√≥n dada:</b><br>\\[ f(x) = ${funcionStr} \\]<br><br>`;
    pasos += `<b>3Ô∏è‚É£ Sustituci√≥n:</b><br>\\[ f(x+h) = ${f_xh_str} \\]<br><br>`;
    pasos += `<b>4Ô∏è‚É£ Resta f(x+h) - f(x):</b><br>\\[ f(x+h) - f(x) = ${resta} \\]<br><br>`;
    pasos += `<b>5Ô∏è‚É£ Aplicamos en la fracci√≥n:</b><br>\\[ \frac{${resta}}{h} \\]<br><br>`;
    pasos += `<b>6Ô∏è‚É£ Simplificamos:</b><br>\\[ \frac{${math.simplify(resta)}}{h} = ${fraccion} \\]<br><br>`;
    pasos += `<b>7Ô∏è‚É£ L√≠mite cuando h \to 0:</b><br>\\[ \lim_{h \to 0} ${fraccion} = ${derivada} \\]<br><br>`;
    pasos += `<b>8Ô∏è‚É£ Conclusi√≥n:</b><br>\\[ f'(x) = ${derivada} \\]`;

    document.getElementById("explicacion").innerHTML = pasos;
    MathJax.typeset();

    const f = (x) => parser.evaluate(`f(${x})`);
    const df = (x) => parser.evaluate(derivada.replace(/x/g, `(${x})`));
    const xs = [], ys1 = [], ys2 = [];

    for (let xi = -10; xi <= 10; xi += 0.1) {
      xs.push(xi);
      ys1.push(f(xi));
      ys2.push(df(xi));
    }

    const trace1 = {
      x: xs,
      y: ys1,
      mode: 'lines',
      name: 'f(x)',
      line: { color: '#e75480' }
    };
    const trace2 = {
      x: xs,
      y: ys2,
      mode: 'lines',
      name: "f'(x)",
      line: { color: '#800080' }
    };

    const layout = {
      title: 'üå∏ Gr√°fica de f(x) y su derivada üå∏',
      xaxis: { title: 'x', gridcolor: '#ffccdd' },
      yaxis: { title: 'Valor', gridcolor: '#ffccdd' },
      plot_bgcolor: '#fff0f5',
      paper_bgcolor: '#fff0f5',
      font: { color: '#800040', size: 14 }
    };

    Plotly.newPlot('grafica', [trace1, trace2], layout);

  } catch (error) {
    document.getElementById("explicacion").innerHTML = `<p style="color:red;">‚ö†Ô∏è Error al procesar la funci√≥n. Revisa la sintaxis.</p>`;
  }
}
</script>

</body>
</html>

