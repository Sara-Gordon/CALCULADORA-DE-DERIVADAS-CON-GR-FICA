<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Derivada - M√©todo del L√≠mite</title>

<!-- MathJax para f√≥rmulas -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Plotly para gr√°ficas -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- math.js para c√°lculos -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
input, button { padding: 8px; margin: 5px; }
.resultado { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-top: 15px; }
</style>
</head>
<body>

<h1>üìò Derivada usando la f√≥rmula del l√≠mite</h1>
<p>Introduce la funci√≥n \(f(x)\):</p>
<input type="text" id="funcion" value="x^2 + 3*x + 2" size="30">
<p>Introduce el punto \(x_0\) para el ejemplo num√©rico:</p>
<input type="number" id="x0" value="2" step="any">
<button onclick="calcular()">Calcular derivada</button>

<div class="resultado" id="explicacion"></div>
<div id="grafica" style="width:100%;height:500px;"></div>

<script>
function calcular() {
    const funcionStr = document.getElementById("funcion").value;
    const x0 = parseFloat(document.getElementById("x0").value);

    try {
        const parser = math.parser();
        parser.evaluate(f(x) = ${funcionStr});

        let pasos = "";

        // Paso 1: Presentar la f√≥rmula
        pasos += <b>1Ô∏è‚É£ Definici√≥n formal de la derivada:</b><br>;
        pasos += `\\[
        f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}
        \\]<br><br>`;

        // Paso 2: Identificar f(x)
        pasos += <b>2Ô∏è‚É£ Funci√≥n dada:</b> \( f(x) = ${funcionStr} \)<br><br>;

        // Paso 3: Sustituir x+h en f(x)
        const f_xh_str = funcionStr.replace(/x/g, "(x+h)");
        pasos += <b>3Ô∏è‚É£ Sustituimos x+h:</b><br>;
        pasos += `\\[
        f(x+h) = ${f_xh_str}
        \\]<br><br>`;

        // Paso 4: Restar f(x)
        pasos += <b>4Ô∏è‚É£ Calculamos f(x+h) - f(x):</b><br>;
        const exprOriginal = math.parse(funcionStr);
        const exprXh = math.parse(f_xh_str);
        const resta = math.simplify((${exprXh}) - (${exprOriginal}));
        pasos += `\\[
        ${resta.toString()}
        \\]<br><br>`;

        // Paso 5: Colocar en la fracci√≥n
        pasos += <b>5Ô∏è‚É£ Colocamos en la f√≥rmula:</b><br>;
        pasos += `\\[
        \\frac{${resta.toString()}}{h}
        \\]<br><br>`;

        // Paso 6: Simplificar
        const simplificada = math.simplify((${resta}) / h);
        pasos += <b>6Ô∏è‚É£ Simplificamos la fracci√≥n:</b><br>;
        pasos += `\\[
        ${simplificada.toString()}
        \\]<br><br>`;

        // Paso 7: Tomar el l√≠mite h->0
        const derivada = math.simplify(simplificada.toString().replace(/h/g, "0"));
        pasos += <b>7Ô∏è‚É£ Tomamos el l√≠mite cuando h ‚Üí 0:</b><br>;
        pasos += `\\[
        ${derivada.toString()}
        \\]<br><br>`;

        // Paso 8: Conclusi√≥n
        pasos += <b>8Ô∏è‚É£ Conclusi√≥n:</b> La derivada es:<br>;
        pasos += `\\[
        f'(x) = ${derivada.toString()}
        \\]`;

        document.getElementById("explicacion").innerHTML = pasos;
        MathJax.typeset();

        // --- Gr√°fica ---
        const f = (x) => parser.evaluate(f(${x}));
        const df = (x) => parser.evaluate(derivada.toString().replace(/x/g, (${x})));

        let xs = [], ys1 = [], ys2 = [];
        for (let xi = -10; xi <= 10; xi += 0.1) {
            xs.push(xi);
            ys1.push(f(xi));
            ys2.push(df(xi));
        }

        const trace1 = { x: xs, y: ys1, type: 'scatter', name: 'f(x)' };
        const trace2 = { x: xs, y: ys2, type: 'scatter', name: "f'(x)" };

        Plotly.newPlot('grafica', [trace1, trace2], {
            title: 'Funci√≥n y su derivada',
            xaxis: { title: 'x' },
            yaxis: { title: 'Valor' }
        });

    } catch (err) {
        document.getElementById("explicacion").innerHTML = <b>Error:</b> Revisa la sintaxis de la funci√≥n.;
    }
}
</script>

</body>
</html>

