<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Derivadas Paso a Paso ‚ú®</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff0f5;
      color: #333;
      padding: 20px;
    }

    h1 {
      color: #c71585;
      text-align: center;
      font-size: 2.5em;
    }

    input, button {
      font-size: 1em;
      padding: 10px;
      margin: 10px 0;
      border: 2px solid #c71585;
      border-radius: 10px;
    }

    button {
      background-color: #c71585;
      color: white;
      cursor: pointer;
    }

    .resultado, .grafica {
      background-color: #ffe4ec;
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
    }

    .paso {
      margin-bottom: 15px;
      line-height: 1.6;
    }

    #grafico {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>üß† Derivadas Paso a Paso</h1>
  <p>Escribe una funci√≥n (ej: <code>x^2</code>, <code>1/x</code>, <code>sin(x)</code>, <code>sqrt(x)</code>):</p>
  <input type="text" id="funcion" placeholder="Ejemplo: x^2 + 3x" />
  <button onclick="resolver()">Mostrar derivada paso a paso</button>

  <div id="resultado" class="resultado"></div>
  <div id="grafico" class="grafica"></div>

  <script>
    function resolver() {
      const funcionInput = document.getElementById('funcion').value;
      const resultadoDiv = document.getElementById('resultado');
      const graficoDiv = document.getElementById('grafico');
      resultadoDiv.innerHTML = "";
      graficoDiv.innerHTML = "";

      try {
        const f = math.parse(funcionInput);
        const df = math.derivative(f, 'x');

        const fStr = f.toString();
        const dfStr = df.toString();

        // PASO A PASO
        let pasos = `
          <div class="paso"><b>PASO 1:</b> Se parte de la definici√≥n formal de derivada:</div>
          <div class="paso">\\[ f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h} \\]</div>

          <div class="paso"><b>PASO 2:</b> Se reemplaza la funci√≥n original: \\( f(x) = ${fStr} \\)</div>

          <div class="paso"><b>PASO 3:</b> Se calcula \\( f(x+h) \\): sustituimos \\( x \\) por \\( x+h \\)</div>
          <div class="paso">\\( f(x+h) = ${math.simplify(f.toString().replaceAll('x', '(x+h)')).toString()} \\)</div>

          <div class="paso"><b>PASO 4:</b> Se aplica la f√≥rmula: </div>
          <div class="paso">\\[ \\frac{${math.simplify(f.toString().replaceAll('x', '(x+h)')).toString()} - (${fStr})}{h} \\]</div>

          <div class="paso"><b>PASO 5:</b> Se simplifica la expresi√≥n anterior.</div>

          <div class="paso"><b>PASO 6:</b> Se toma el l√≠mite cuando \\( h \\to 0 \\):</div>
          <div class="paso">\\[ f'(x) = ${dfStr} \\]</div>

          <div class="paso"><b>PASO 7:</b> Esta es la derivada obtenida por el primer principio de derivaci√≥n.</div>

          <div class="paso"><b>PASO 8:</b> Finalmente se representa la gr√°fica de \\( f(x) \\) y \\( f'(x) \\).</div>
        `;

        resultadoDiv.innerHTML = pasos;
        MathJax.typeset(); // renderiza MathJax

        // GRAFICAR
        const exprOriginal = math.compile(fStr);
        const exprDerivada = math.compile(dfStr);

        const x_vals = math.range(-10, 10, 0.5).toArray();
        const y_vals = x_vals.map(x => {
          try { return exprOriginal.evaluate({x}); }
          catch { return null; }
        });
        const dy_vals = x_vals.map(x => {
          try { return exprDerivada.evaluate({x}); }
          catch { return null; }
        });

        const trace1 = {
          x: x_vals,
          y: y_vals,
          mode: 'lines',
          name: 'f(x)',
          line: { color: '#d87093', width: 3 }
        };

        const trace2 = {
          x: x_vals,
          y: dy_vals,
          mode: 'lines',
          name: "f'(x)",
          line: { color: '#8b008b', width: 3, dash: 'dot' }
        };

        const layout = {
          title: 'Gr√°fica de la funci√≥n y su derivada',
          xaxis: { title: 'x' },
          yaxis: { title: 'y' },
          plot_bgcolor: '#fff0f5',
          paper_bgcolor: '#fff0f5'
        };

        Plotly.newPlot(graficoDiv, [trace1, trace2], layout);
      } catch (error) {
        resultadoDiv.innerHTML = `<b style="color: red;">‚ö†Ô∏è Error al procesar la funci√≥n. Aseg√∫rate de escribirla correctamente.</b>`;
      }
    }
  </script>
</body>
</html>
